<?php
/**
 * Admin interface for VideoThumbnail module
 * Simplified version without messenger dependency
 */
$this->headTitle($this->translate('Video Thumbnail'));
$this->htmlElement('body')->appendAttribute('class', 'video-thumbnail browse');

// Add debug info
error_log('DEBUG: Admin template rendering - ' . date('Y-m-d H:i:s'));
error_log('DEBUG: Form object type: ' . (is_object($form) ? get_class($form) : 'not an object'));
error_log('DEBUG: Form elements: ' . (is_object($form) && method_exists($form, 'getElements') ? implode(', ', array_keys($form->getElements())) : 'unknown'));
?>

<!-- Debug information (remove in production) -->
<div style="background:#ffe; border:1px solid #ccc; padding:10px; margin:10px 0; display:none;">
    <h3>Debug Info</h3>
    <p>Template Variables:</p>
    <ul>
        <li>Form: <?= is_object($form) ? get_class($form) : 'not an object' ?></li>
        <li>Video Count: <?= isset($videoCount) ? $videoCount : 'undefined' ?></li>
        <li>Default Frame: <?= isset($defaultFrame) ? $defaultFrame : 'undefined' ?></li>
        <li>Debug Mode: <?= isset($debugMode) ? ($debugMode ? 'true' : 'false') : 'undefined' ?></li>
    </ul>
</div>

<div id="page-actions">
    <a href="<?= $this->escapeHtml($this->url('admin/default', ['controller' => 'module'])) ?>" class="button">
        <?= $this->translate('Back to modules'); ?>
    </a>
</div>

<h1><?= $this->translate('Video Thumbnail Manager'); ?></h1>

<div class="video-thumbnail-overview">
    <h2><?= $this->translate('Overview'); ?></h2>
    
    <div class="stats">
        <p><strong><?= $this->translate('Videos in repository:'); ?></strong> <?= $this->escapeHtml($videoCount); ?></p>
        <p><strong><?= $this->translate('Default frame position:'); ?></strong> <?= $this->escapeHtml($defaultFrame); ?>%</p>
        <p><strong><?= $this->translate('Debug mode:'); ?></strong> <?= $debugMode ? $this->translate('Enabled') : $this->translate('Disabled'); ?></p>
    </div>
</div>

<div class="video-thumbnail-configuration">
    <h2><?= $this->translate('Configuration'); ?></h2>
    
    <?php
    // Ensure form has correct action URL
    $form->setAttribute('action', $this->url('admin/video-thumbnail'));
    $form->setAttribute('method', 'post');
    $form->prepare();
    ?>
    
    <?= $this->form()->openTag($form); ?>
    
    <fieldset id="settings-fieldset" class="section">
        <legend><?= $this->translate('Settings'); ?></legend>
        
        <div class="field">
            <?= $this->formLabel($form->get('default_frame_position')); ?>
            <div class="inputs"><?= $this->formNumber($form->get('default_frame_position')); ?></div>
            <div class="field-description"><?= $this->translate('Default position for thumbnail extraction as percentage of video duration (0-100).'); ?></div>
        </div>
        
        <div class="field">
            <?= $this->formLabel($form->get('supported_formats')); ?>
            <div class="inputs"><?= $this->formMultiCheckbox($form->get('supported_formats')); ?></div>
            <div class="field-description"><?= $this->translate('Select video formats that should be processed.'); ?></div>
        </div>
        
        <div class="field">
            <?= $this->formLabel($form->get('debug_mode')); ?>
            <div class="inputs"><?= $this->formCheckbox($form->get('debug_mode')); ?></div>
            <div class="field-description"><?= $this->translate('Enable detailed debug logging.'); ?></div>
        </div>
    </fieldset>
    
    <fieldset id="tools-fieldset" class="section">
        <legend><?= $this->translate('Tools'); ?></legend>
        
        <div class="field">
            <?= $this->formLabel($form->get('regenerate_thumbnails')); ?>
            <div class="inputs"><?= $this->formCheckbox($form->get('regenerate_thumbnails')); ?></div>
            <div class="field-description"><?= $this->translate('Check to regenerate all video thumbnails using settings above.'); ?></div>
        </div>
    </fieldset>
    
    <div class="form-submit">
        <?= $this->formSubmit($form->get('submit')); ?>
    </div>
    
    <?= $this->form()->closeTag(); ?>
</div>

<div class="usage">
    <h2><?= $this->translate('Usage'); ?></h2>
    <ol>
        <li><?= $this->translate('Upload video files to your Omeka S repository.'); ?></li>
        <li><?= $this->translate('Add a "Video Thumbnail" block to a page.'); ?></li>
        <li><?= $this->translate('Select a video using the "Select Video" button.'); ?></li>
        <li><?= $this->translate('Choose a frame position (0-100%) from the video to use as the thumbnail.'); ?></li>
    </ol>
</div>

<style>
fieldset {
    border: 1px solid #dfdfdf;
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 3px;
    background-color: #f9f9f9;
}
legend {
    font-weight: bold;
    font-size: 1.1em;
    background: #fff;
    padding: 0 10px;
}
.form-input {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
}
.form-input:last-child {
    border-bottom: none;
}
.form-input label {
    display: block;
    font-weight: bold;
    margin-bottom: 0.5rem;
}
.stats {
    background: #f5f5f5;
    padding: 1rem;
    border-radius: 3px;
    margin-bottom: 1rem;
}
.video-thumbnail-configuration,
.video-thumbnail-overview,
.usage {
    margin-bottom: 2rem;
}
#submit {
    padding: 0.5rem 1rem;
    background-color: #3c8dbc;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
}
</style>